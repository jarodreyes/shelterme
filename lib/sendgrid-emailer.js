var helper = require('sendgrid').mail;
var from_email = new helper.Email('shakespeare@twlo.codes', "Help Me Shakespeare!");
var subject = "Thanks for using #HelpMeShakespeare!";

var Emailer = function() { };

Emailer.prototype.sendEmail = function(user) {
  var to_email = new helper.Email(user.email);
  var content = new helper.Content("text/html", '<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="initial-scale=1.0"><meta name="format-detection" content="telephone=no"><title>MOSAICO Responsive Email Designer</title><style type="text/css">.socialLinks {font-size: 6px;} .socialLinks a {display: inline-block;} .socialIcon {display: inline-block;vertical-align: top;padding-bottom: 0px;border-radius: 100%;} table.vb-row, table.vb-content {border-collapse: separate;} table.vb-row {border-spacing: 9px;} table.vb-row.halfpad {border-spacing: 0;padding-left: 9px;padding-right: 9px;} table.vb-row.fullwidth {border-spacing: 0;padding: 0;} table.vb-container.fullwidth {padding-left: 0;padding-right: 0;}</style><style type="text/css"> /* yahoo, hotmail */ .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div{ line-height: 100%; } .yshortcuts a{ border-bottom: none !important; } .vb-outer{ min-width: 0 !important; } .RMsgBdy, .ExternalClass{width: 100%; background-color: #3f3f3f; background-color: #3f3f3f} /* outlook */ table{ mso-table-rspace: 0pt; mso-table-lspace: 0pt; } #outlook a{ padding: 0; } img{ outline: none; text-decoration: none; border: none; -ms-interpolation-mode: bicubic; } a img{ border: none; } @media screen and (max-device-width: 600px), screen and (max-width: 600px) {table.vb-container, table.vb-row{width: 95% !important; } .mobile-hide{ display: none !important; } .mobile-textcenter{ text-align: center !important; } .mobile-full{float: none !important; width: 100% !important; max-width: none !important; padding-right: 0 !important; padding-left: 0 !important; } img.mobile-full{width: 100% !important; max-width: none !important; height: auto !important; } } </style><style type="text/css">#ko_singleArticleBlock_3 .links-color a, #ko_singleArticleBlock_3 .links-color a:link, #ko_singleArticleBlock_3 .links-color a:visited, #ko_singleArticleBlock_3 .links-color a:hover {color: #3f3f3f;color: #3f3f3f;text-decoration: underline;} #ko_footerBlock_2 .links-color a:visited, #ko_footerBlock_2 .links-color a:hover {color: #ccc;color: #ccc;text-decoration: underline;}</style></head><body bgcolor="#3f3f3f" text="#919191" alink="#cccccc" vlink="#cccccc" style="margin: 0;padding: 0;background-color: #3f3f3f;color: #919191;"> <center> <!-- preheaderBlock --> <!-- /preheaderBlock --> <table class="vb-outer" width="100%" cellpadding="0" border="0" cellspacing="0" bgcolor="#0f243e" style="background-color: #0f243e;" id="ko_singleArticleBlock_3"><tbody><tr><td class="vb-outer" align="center" valign="top" bgcolor="#0f243e" style="padding-left: 9px;padding-right: 9px;background-color: #0f243e;"> <!--[if (gte mso 9)|(lte ie 8)]><table align="center" border="0" cellspacing="0" cellpadding="0" width="570"><tr><td align="center" valign="top"><![endif]--> <div class="oldwebkit" style="max-width: 570px;"> <table width="570" border="0" cellpadding="0" cellspacing="18" class="vb-container fullpad" bgcolor="#ffffff" style="border-collapse: separate;border-spacing: 18px;padding-left: 0;padding-right: 0;width: 100%;max-width: 570px;background-color: #fff;"><tbody><tr><td width="100%" valign="top" align="left" class="links-color"> <img border="0" hspace="0" vspace="0" width="534" class="mobile-full" alt="" style="border: 0px;display: block;vertical-align: top;max-width: 534px;width: 100%;height: auto;" src="https://mosaico.io/srv/f-9br8x81/img?src=https%3A%2F%2Fmosaico.io%2Ffiles%2F9br8x81%2Femail-banner.gif&amp;method=resize&amp;params=534%2Cnull"></td> </tr><tr><td><table align="left" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td style="font-size: 18px; font-family: Arial, Helvetica, sans-serif; color: #3f3f3f; text-align: left;"> <span style="color: #3f3f3f;">Happy Valentine\'s day '+user.firstName+'!<br data-mce-bogus="1"></span> </td> </tr><tr><td height="9" style="font-size: 1px; line-height: 1px;"> </td> </tr><tr><td align="left" class="long-text links-color" style="text-align: left; font-size: 13px; font-family: Arial, Helvetica, sans-serif; color: #3f3f3f;"><p style="margin: 1em 0px;margin-top: 0px;">Twilio loves to make love happen. That\'s why this February we built a help-line for all of those romantics out there, who might be at a loss for words. We understand, we take your breath away. So instead of landing flat-footed on the big night, why not send a sonnet to the one you love, custom made by shakespeare. And if you do feel confident, why not run your idea by old Billy and see if he approves of your diction.</p><p style="margin: 1em 0px;margin-bottom: 0px;">And just a reminder, we promise we will only use your email to send your sonnets. If you\'d like you can email privacy@twilio.com and we\'ll delete all of the information associated with this campaign. Thanks for believing, and have a happy Valentine\'s!</p></td> </tr><tr><td align="left" class="long-text links-color" style="text-align: left; font-size: 13px; font-family: Arial, Helvetica, sans-serif; color: #3f3f3f;"><p style="margin: 1em 0px;margin-top: 0px;">Twilio is powering the people building some of the world\'s most innovative communications.</p><p style="margin: 1em 0px;margin-top: 0px;">To learn more visit <a href="http://twilio.com">twilio.com</a>.</p></td> </tr><tr><td height="13" style="font-size: 1px; line-height: 1px;"> </td> </tr></tbody></table></td> </tr></tbody></table></td></tr></tbody></table></div> <!--[if (gte mso 9)|(lte ie 8)]></td></tr></table><![endif]--> </td> </tr></tbody></table></center> </body></html>');
  var mail = new helper.Mail(from_email, subject, to_email, content);

  var sg = require('sendgrid')(process.env.SENDGRID_API_KEY);
  var request = sg.emptyRequest({
    method: 'POST',
    path: '/v3/mail/send',
    body: mail.toJSON()
  });
  sg.API(request, function(error, response) {
    console.log(response.statusCode);
    console.log(response.body);
    console.log(response.headers);
  });
};

emailr = new Emailer();

module.exports = new Emailer();